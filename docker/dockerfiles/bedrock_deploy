FROM quay.io/deis/base:0.3.0

ENV PYTHONDONTWRITEBYTECODE=1
ENV PIP_DISABLE_PIP_VERSION_CHECK=1
ENV LANG=C.UTF-8

EXPOSE 8000
CMD ["./docker/run-prod.sh"]

RUN apt-get update && \
    apt-get install -y --no-install-recommends python2.7 libpython2.7 build-essential \
    python-dev python-pip python-setuptools \
    gettext libxml2-dev libxslt1.1 libxslt1-dev libpq-dev

WORKDIR /app
COPY . /app/
RUN echo "${GIT_COMMIT}" > static/revision.txt

RUN pip install --no-cache-dir -r requirements/docker.txt
RUN pip install --no-cache-dir -r requirements/prod.txt

RUN adduser --uid 1000 --disabled-password --gecos '' --no-create-home webdev
RUN chown webdev.webdev -R .
USER webdev
